<!DOCTYPE html>

<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <title>Dashboard Ambiental ‚Äì Agricultura IoT</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --green: #2e7d32;
        --yellow: #f9a825;
        --red: #c62828;
        --blue: #1565c0;
        --bg: #f4f7f5;
        --card: #ffffff;
        --text: #263238;
      }
      .sonoff-controls {
        display: flex;
        gap: 14px;
        margin-top: 18px;
      }

      .sonoff-btn {
        flex: 1;
        padding: 16px;
        font-size: 16px;
        font-weight: 700;
        border-radius: 16px;
        border: none;
        cursor: pointer;
        color: white;
        transition: all 0.25s ease;
        box-shadow: 0 8px 20px rgba(0,0,0,0.15);
      }

      .sonoff-btn.on {
        background: linear-gradient(135deg, #2e7d32, #43a047);
      }

      .sonoff-btn.off {
        background: linear-gradient(135deg, #c62828, #e53935);
      }

      .sonoff-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 28px rgba(0,0,0,0.25);
      }

      .sonoff-btn:active {
        transform: scale(0.97);
      }

      /* Mobile */
      @media (max-width: 480px) {
        .sonoff-controls {
          flex-direction: column;
        }
      }


      * {
        box-sizing: border-box;
        font-family: "Inter", sans-serif;
      }
      body {
        margin: 0;
        background: linear-gradient(135deg, #e8f5e9, #f1f8e9);
        color: var(--text);
      }
      header {
        text-align: center;
        padding: 30px;
      }
      header h1 {
        margin: 0;
        font-size: 32px;
        color: var(--green);
      }
      header p {
        margin-top: 10px;
        font-size: 16px;
        opacity: 0.8;
      }
      .dashboard {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 25px;
        padding: 30px;
        align-items: stretch;
      }
      .card {
        background: var(--card);
        border-radius: 22px;
        padding: 25px;
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.08);
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        min-height: 220px;
      }
      .card h2 {
        margin: 0;
        font-size: 18px;
        color: var(--green);
      }
      .box {
        margin-top: 20px;
        font-size: 46px;
        font-weight: 700;
        padding: 18px;
        border-radius: 16px;
        color: #fff;
        text-align: center;
      }
      .status {
        margin-top: 10px;
        font-size: 15px;
        font-weight: 600;
      }
      .good {
        background: var(--green);
      }
      .mid {
        background: var(--yellow);
      }
      .bad {
        background: var(--red);
      }
      .blue {
        background: var(--blue);
      }
      .offline {
        background: #9e9e9e;
      }
      footer {
        text-align: center;
        padding: 20px;
        font-size: 14px;
        opacity: 0.6;
      }
      @media (max-width: 768px) {
        header h1 {
          font-size: 24px;
        }
        .dashboard {
          padding: 15px;
          gap: 15px;
        }
        .box {
          font-size: 38px;
        }
      }
      @media (max-width: 420px) {
        .dashboard {
          grid-template-columns: 1fr;
        }
        .box {
          font-size: 34px;
        }
      }
      
    </style>
  </head>
  <body>
    <header>
      <h1>üå± Monitor Ambiental Inteligente</h1>
      <p>Agricultura familiar ‚Ä¢ IoT ‚Ä¢ ESP32</p>
    </header>
    <section class="dashboard">
      <div class="card">
        <h2>Umidade do Solo ‚Äì ESP32 #1</h2>
        <div class="box" id="b1">--%</div>
        <div class="status" id="s1">---</div>
      </div>
      <div class="card">
        <h2>Umidade do Solo ‚Äì ESP32 #2</h2>
        <div class="box" id="b2">--%</div>
        <div class="status" id="s2">---</div>
      </div>
      <div class="card">
        <h2>Umidade do Solo ‚Äì ESP32 #3</h2>
        <div class="box" id="b3">--%</div>
        <div class="status" id="s3">---</div>
      </div>
      <div class="card">
        <h2>M√©dia Geral do Solo</h2>
        <div class="box" id="bm">--%</div>
        <div class="status" id="sm">---</div>
      </div>
      <div class="card">
        <h2>üå°Ô∏è Temperatura ‚Äì BME280</h2>
        <div class="box blue" id="temp">-- ¬∞C</div>
        <div class="status">Temperatura do ar</div>
      </div>
      <div class="card">
        <h2>üíß Umidade do Ar ‚Äì BME280</h2>
        <div class="box mid" id="um_ar">--%</div>
        <div class="status">Umidade relativa</div>
      </div>
      <div class="card">
        <h2>üìà Press√£o Atmosf√©rica</h2>
        <div class="box" style="background: #546e7a" id="pressao">-- hPa</div>
        <div class="status">Press√£o do ar</div>
      </div>
      <div class="card">
        <h2>‚õ∞Ô∏è Altitude Estimada</h2>
        <div class="box" style="background: #8d6e63" id="altitude">-- m</div>
        <div class="status">Altitude</div>
      </div>
      <div class="card">
  <h2>üîå Controle de Irriga√ß√£o</h2>

  <div class="box blue" id="sonoffStatus">
    DESLIGADO
  </div>

  <div class="sonoff-controls">
    <button class="sonoff-btn on" onclick="ligarSonoff()">
      ‚ñ∂ LIGAR
    </button>

    <button class="sonoff-btn off" onclick="desligarSonoff()">
      ‚èπ DESLIGAR
    </button>
  </div>

  <div class="status">
    Sonoff Basic ‚Ä¢ Controle remoto via Internet
  </div>
</div>

    </section>
    <footer>Projeto IoT ‚Ä¢ IFSP ‚Ä¢ Agricultura Sustent√°vel</footer>
    <script>
      const espSolo = [
        "http://192.168.100.91/dados",
        "http://192.168.100.92/dados",
        "http://192.168.100.93/dados",
      ];
      const espBMP = "http://192.168.100.9/dados";
      function pintar(box, status, v) {
        box.className = "box";
        box.innerHTML = v + "%";
        if (v > 80) {
          box.classList.add("good");
          status.innerHTML = "Muito √∫mido";
        } else if (v > 50) {
          box.classList.add("mid");
          status.innerHTML = "√ömido";
        } else {
          box.classList.add("bad");
          status.innerHTML = "Seco";
        }
      }
      async function lerSolo(url) {
        try {
          const r = await fetch(url);
          const j = await r.json();
          return j.umidade_percentual;
        } catch {
          return null;
        }
      }
      async function atualizarSolo() {
        let vals = [];
        for (let i = 0; i < 3; i++) {
          const box = document.getElementById("b" + (i + 1));
          const st = document.getElementById("s" + (i + 1));
          const v = await lerSolo(espSolo[i]);
          if (v === null) {
            box.className = "box offline";
            box.innerHTML = "--";
            st.innerHTML = "OFFLINE";
          } else {
            pintar(box, st, v);
            vals.push(v);
          }
        }
        const bm = document.getElementById("bm");
        const sm = document.getElementById("sm");
        if (vals.length) {
          const m = Math.round(vals.reduce((a, b) => a + b, 0) / vals.length);
          pintar(bm, sm, m);
        } else {
          bm.className = "box offline";
          bm.innerHTML = "--";
          sm.innerHTML = "Sem dados";
        }
      }
      async function atualizarBMP() {
        try {
          const r = await fetch(espBMP);
          const d = await r.json();
          const t = document.getElementById("temp");
          t.className = "box blue";
          t.innerHTML = d.temperatura_c.toFixed(1) + " ¬∞C";
          document.getElementById("um_ar").innerHTML =
            d["umidade_%"].toFixed(1) + "%";
          document.getElementById("pressao").innerHTML =
            d.pressao_hpa.toFixed(1) + " hPa";
          document.getElementById("altitude").innerHTML =
            d.altitude_m.toFixed(1) + " m";
        } catch (e) {
          const t = document.getElementById("temp");
          t.className = "box offline";
          t.innerHTML = "-- ¬∞C";
          console.error(e);
        }
      }
      setInterval(() => {
        atualizarSolo();
        atualizarBMP();
      }, 3000);
      atualizarSolo();
      atualizarBMP();

    const IFTTT_KEY = "SUA_KEY_AQUI";

    function ligarSonoff() {
      fetch(`https://maker.ifttt.com/trigger/sonoff_ligar/with/key/${IFTTT_KEY}`);
      const box = document.getElementById("sonoffStatus");
      box.innerHTML = "LIGADO";
      box.className = "box good";
    }

    function desligarSonoff() {
      fetch(`https://maker.ifttt.com/trigger/sonoff_desligar/with/key/${IFTTT_KEY}`);
      const box = document.getElementById("sonoffStatus");
      box.innerHTML = "DESLIGADO";
      box.className = "box bad";
    }
    
    </script>
  </body>
</html>
